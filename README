# TobaccoCS

## Health Check
### Command
{
    "sender": "tabacco/control",
    "receiver": "tabacco/1",
    "device_nr": 1,
    "device_type": 4,
    "message_id": 1,
    "ackn": "request",
    "topic": "health_check",
    "command": "execute",
    "data": ""
}
### Response
{
    "sender": "tabacco/1",
    "receiver": "tabacco/control",
    "device_nr": 1,
    "device_type": 4,
    "message_id": 1,
    "ackn": "acknowledged",
    "topic": "health_check",
    "command": "executed",
    "data": [
        {
            "tube_nr": 0,
            "error": "com_failed"
        },
        {
            "tube_nr": 1,
            "error": "not_configured"
        }
    ]
}

## Check if empty
### Command
{

    "sender": "tabacco/control",
    "receiver": "tabacco/1",
    "device_nr": 1,
    "device_type": 4,
    "message_id": 1,
    "ackn": "request",
    "topic": "check_if_empty",
    "command": "execute",
    "data": ""
}
### Response
{
    "sender": "tabacco/1",
    "receiver": "tabacco/control",
    "device_nr": 1,
    "device_type": 4,
    "message_id": 1,
    "ackn": "acknowledged",
    "topic": "check_if_empty",
    "command": "executed",
    "data": [
        {
            "tube_nr": 0,
            "error": "no_error"
        },
        {
            "tube_nr": 2,
            "error": "tube_empty"
        },
        {
            "tube_nr": 3,
            "error": "communication_failed"
        }

    ]
}

## release content
### Command
{

    "sender": "tabacco/control",
    "receiver": "tabacco/1",
    "device_nr": 1,
    "device_type": 4,
    "message_id": 1,
    "ackn": "request",
    "topic": "release_content",
    "command": "execute",
    "data": [1,2] // tubes nummeriert von 1 - 39 für das Teststeup
}
### Response after each push
{
    "sender": "tabacco/1",
    "receiver": "tabacco/control",
    "device_nr": 1,
    "device_type": 4,
    "message_id": 1,
    "ackn": "acknowledged",
    "topic": "release_content",
    "command": "update",
    "data": {
        "tube_nr": 1,
        "success": true,
        "error": "no_error"
    }
}
### Response end
{
    "sender": "tabacco/1",
    "receiver": "tabacco/control",
    "device_nr": 1,
    "device_type": 4,
    "message_id": 1,
    "ackn": "acknowledged",
    "topic": "release_content",
    "command": "executed",
    "data": [
        {
            "tube_nr": 1,
            "success": true,
            "error": "no_error"
        },
        {
            "tube_nr": 2,
            "success": true,
            "error": "tube_emptied"
        },
        {
            "tube_nr": 3,
            "success": false,
            "error": "tube_empty"
        },
        {
            "tube_nr": 4,
            "success": false,
            "error": "communication_failed"
        }

    ]
}

## I2C adresse setzen
### Command
{
    "sender": "tabacco/control",
    "receiver": "tabacco/1",
    "device_nr": 1,
    "device_type": 4,
    "message_id": 1,
    "ackn": "request",
    "topic": "set_i2c_address",
    "command": "execute",
    "data": 1 // tubes nummeriert von 1 - 39 für das Teststeup
}
### Response
{
    "sender": "tabacco/1",
    "receiver": "tabacco/control",
    "device_nr": 1,
    "device_type": 4,
    "message_id": 1,
    "ackn": "acknowledged",
    "topic": "check_if_empty",
    "command": "executed",
    "error":"no error", // Fehlerbeschreibung
    "data": 1
}